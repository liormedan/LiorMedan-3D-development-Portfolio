# תכנית פיתוח – חנות 3D, הדמיית אודיו, וסייר קבצים

מסמך זה מרכז את מפת הדרכים והמשימות להמשך פיתוח שלוש האפליקציות: חנות מוצרים בתלת־ממד, הדמיית גלי קול, וסייר קבצים בתלת־ממד. המשימות מחולקות לפי אפליקציה ותשתיות משותפות, כולל סדרי עדיפויות מוצעים.

## עקרונות כלליים
- פשטות ויציבות מעל הכל; להתחיל מ-MVP ולהרחיב בהדרגה.
- שימור ביצועים: להשתמש ב-Code Splitting, Dynamic Import, ו-Instancing ב-3D.
- חוויית משתמש: נגישות, רספונסיביות, תמיכה בדפדפנים עיקריים.
- בדיקות: יחידה/מרכיב לאזורים קריטיים, וצ׳קים אוטומטיים ב-CI.

---

## אפליקציה 1: חנות מוצרים 3D (`/products`)

### ליבה (P0)
- [x] תשתית נתונים למוצרים (שם, מחיר, תיאור, קישורי מדיה, נתיב/קישור לדגם 3D)
  - נוספו טיפוסים ומערך נתונים: `lib/products.ts`
  - נפתח API: `app/api/products/route.ts` (רשימה או `?slug=`)
  - עמוד `/products` עודכן: רשימת מוצרים + תצוגה וייצוא GLTF
 - [x] טעינת דגמי GLB/GLTF במקום דגם הדמו (קובייה)
   - הוספה ל-`/products`: טעינת GLTF באמצעות `useGLTF` מ-`modelPath` עם נפילה לקובייה בעת חוסר קובץ
   - תמיכה ב-Preload לדגמים ידועים, ו-`Center` להתאמת סצנה למסך
- [x] רשימת מוצרים + עמוד מוצר מפורט (תמונות/תצוגת 3D, מפרט, כפתור הוספה לסל)
  - `/products` מציג גריד מוצרים וקישור לעמודי מוצר
  - עמוד דינמי: `/products/[slug]` + רכיב לקוח להצגת 3D ופרטים
  - חנות: Zustand לסל (`lib/cart.ts`) וכפתור "הוספה לסל"
- [x] סל קניות בצד לקוח (zustand) עם שמירה ב-`localStorage`
  - נוספה התמדה עם `zustand/middleware` (`persist`) ב-`lib/cart.ts` תחת המפתח `cart-v1`
  - שמירת `items` ל-`localStorage` וטעינה אוטומטית בהידרציה בצד לקוח
- [x] ייצוא/הורדה: הורדת הדגם הספציפי של המוצר (GLTF/GLB); תמיכה ב-DRACO בהמשך
  - כפתורי הורדה/ייצוא ב-`/products` וב-`/products/[slug]`:
    - הורדת קובץ מקור אם מוגדר `modelPath`
    - ייצוא כ‑GLTF (JSON) ו‑GLB (Binary) באמצעות `GLTFExporter`
  - DRACO: יתווסף בשלב הבא לצרכי טעינה/דחיסה; נדרש אינטגרציית דקודר בלואדר או Preprocess

### תשלום וקופה (P0-P1)
- [x] אינטגרציית תשלום (Stripe Checkout/Payment Links) – Sandbox תחילה
  - נוספה חבילת `stripe` ל-`package.json`
  - API: `app/api/checkout/route.ts` יוצר Checkout Session לפי פריטי סל
  - עמוד סל: `app/cart/page.tsx` עם כפתור "לתשלום ב‑Stripe"
  - קובץ סביבה: `STRIPE_SECRET_KEY` ב-`.env.example`, שימוש ב-`NEXT_PUBLIC_SITE_URL` לבניית כתובות חזרה
- [x] עמוד Checkout + אישור הזמנה (Success/Cancel)
  - עמודי אישור/ביטול: `/checkout/success` (כולל סיכום הזמנה) ו-`/checkout/cancel`
  - ניקוי הסל בהצלחה: רכיב לקוח `app/checkout/ClearCartOnSuccess.tsx`
  - עדכון המסלול: הפניית Stripe לכתובות החדשות ב-API
- [x] תמחור מטבע/מע״מ/חשבונית (פשטני בשלב ראשון)
  - VAT גלובלי דרך `NEXT_PUBLIC_VAT_PERCENT` (ברירת מחדל 17)
  - חישוב ותצוגה בעגלת הקניות: סכום ביניים, מע"מ ושורת לתשלום
  - גבייה ב‑Stripe לפי מחיר כולל מע"מ (חישוב בצד שרת)
  - עמוד הצלחה: פירוט כולל/לפני מע"מ + כפתור הדפסה/שמירת PDF

### מודלים ותצוגה (P1)
- [x] טעינת מודלים עם `GLTFLoader` + `Suspense`
  - שימוש ב-`useGLTF` (GLTFLoader תחת המכסה) + `Suspense` עם fallback ב-Canvas
- [x] תאימות טקסטורות/חומרים בסיסית (PBR)
  - `Environment` ל-IBL, `ACESFilmicToneMapping`, `SRGBColorSpace`, ו-traverse להפעלת צללים/`envMapIntensity`
- [x] פקד מצלמה נוח (OrbitControls) + מגבלות זום/סיבוב
  - `enableDamping`, מגבלות `minDistance`/`maxDistance`, ו-`min/maxPolarAngle`
 - [x] יצירת תמונות תצוגה (Thumbnails)
   - כפתור יצירת תמונה בצד לקוח: צילום Canvas כ‑PNG + ניסיון העתקה ללוח
   - גריד מוצרים מציג `thumbnail` אם קיים, עם נפילה ל‑`/images/placeholder-thumb.svg`
   - בהמשך: רנדר בצד שרת עם headless-gl לטרום‑עיבוד (נותר כ‑Next step)

### ביצועים (P1)
- [x] דחיסת דגמים (DRACO/KTX2) + טעינה עצלה (lazy)
  - הרחבת GLTFLoader ל‑DRACO ו‑KTX2 דרך `useGLTF(url, loader => ...)` עם מסלולי דקודר/טרנסקודר מרשת
  - `Suspense` + `dpr={[1,1.5]}` ו‑`gl={{ antialias:false }}` להפחתת עלות רנדר
- [x] אופטימיזציית תאורה/צללים, הפחתת polycount היכן שניתן
  - שמירת shadow map ל‑1024, הפעלת `castShadow/receiveShadow` רק לאובייקטים נדרשים
  - Tone mapping: `ACESFilmic` ו‑`sRGB` ל‑IBL יעיל; המלצה: הפחתת polycount במודלים לפני העלאה

### תוכן/SEO (P1)
- [x] מטא־דאטה נקי בעברית ובאנגלית (תיקון `app/layout.tsx` – כרגע יש ג׳יבריש)
  - כותרת/תיאור דו־לשוני, Keywords, ו‑OpenGraph/Twitter ברירת מחדל על בסיס `NEXT_PUBLIC_SITE_URL`
- [x] Open Graph לטובת שיתוף עמודי מוצר
  - `generateMetadata` ב־`/products/[slug]` כולל כותרת/תיאור ותמונת OG מתוך `thumbnail` או פלייסהולדר

### ניהול תוכן (P2)
- [x] 
- [ ] העלאת קבצי מודלים דרך ממשק (אל דיסק/אחסון ענן)

---

## אפליקציה 2: הדמיית גלי קול (`/audio-visualizer`)

### שיפור הדמיה (P0-P1)
- [x] 
- [x] 
- [x] 

### קלט אודיו (P1)
- [x] 
- [x] 
- [x] 

### ביצועים ונגישות (P1)
- [x] 
- [x] 

---

## אפליקציה 3: סייר קבצים 3D (`/file-explorer`)

### הרשאות ודפדפנים (P0)
- [ ] בדיקת תמיכה ב-`showDirectoryPicker`; נפילה לחילופין קבצים ידנית
- [ ] הנחיות UI כשאין הרשאה/תמיכה

### ניווט ותצוגה (P1)
- [ ] תצוגת עץ + פירורי לחם (Breadcrumbs) + “למעלה”
- [x] 
- [ ] פריסה אדפטיבית (גריד/רשימה) + חיפוש מקומי לפי שם

### אינטראקציות (P1-P2)
- [ ] בחירה מרובה + הדגשת בחירה
- [ ] גרירה לסידור (ויזואלי בלבד, ללא כתיבה לדיסק)
- [x] 

### ביצועים (P2)
- [ ] וירטואליזציה של פריטים רבים (טווח תצוגה)
- [ ] InstancedMesh למלבנים רבים ב־3D

---

## תשתיות משותפות

### UI וניווט (P0)
- [x] 
- [ ] קישור חזרה לדף הבית מכל אפליקציה

### מצב אפליקציה (P0-P1)
- [x] 
- [ ] שמירה ב-`localStorage` וסנכרון היידרציוני

### ביצועים (P1)
- [ ] Dynamic Import לכל רכיבי 3D כבדים
- [ ] עצירת רנדר כשלא בפוקוס/לא נראה (דגל `frameloop='demand'` היכן שרלוונטי)

### בדיקות ו-CI (P1)
- [ ] בדיקות יחידה ללוגיקה (סל/חישובי מחיר)
- [ ] בדיקות מרכיב בסיסיות (Rendering ללא שגיאות)
- [ ] ESLint/TypeScript Checks ב-CI

### ניטור ושגיאות (P1)
- [ ] גביית שגיאות לקונסולה עם גבול שגיאות React
- [x] 

### אבטחה (P1)
- [ ] ולידציית קלט בצד לקוח/שרת (Zod אם נדרש)
- [ ] כפתורי הורדה: לוודא שאין חשיפת נתיבים רגישים

### PWA (P2)
- [ ] Manifest + Service Worker לטעינה מהירה/Offline בסיסי (בעיקר לתצוגות)

---

## משימות מהירות (Quick Wins)
- [ ] לתקן מטא־דאטה מקולקלת בעברית ב-`app/layout.tsx`
- [ ] לעדכן `README.md` – להסיר התייחסויות לרכיבי פורטפוליו שנמחקו
- [ ] להוסיף לינק חזרה לדף הבית בראש כל אחת משלוש האפליקציות
- [x] 

---

## שאלות פתוחות
- א. מודלים: האם המודלים יהיו מאוחסנים מקומית, ב-S3, או מנוהלים דרך CMS?
- ב. תשלום: Stripe Checkout מספיק או נדרש תהליך הזמנה מותאם?
- ג. שפות: תמיכה דו־לשונית (עברית/אנגלית) – האם להוסיף i18n עכשיו?
- ד. סטייל: האם לשלב ספריית UI (Radix/HeadlessUI) או להישאר עם Tailwind בלבד?

---

## נספח – חלוקת אבני דרך מוצעת
- שלב 1 (MVP): טעינת דגמים אמיתיים בחנות + הורדה, Audio Visualizer עם שליטה בסיסית, File Explorer עם Directory Picker/קבצים.
- שלב 2: סל + תשלום Stripe, דפי מוצר מלאים, חיפוש בסייר, שיפורי ביצועים 3D.
- שלב 3: פאנל ניהול, אנליטיקס, PWA, וירטואליזציה לסייר, אופטימיזציית מודלים מתקדמת.
